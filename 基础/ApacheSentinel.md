# Apache Sentinel 流量限流

## 常用限流算法：

### 1）计数器算法：

对于A接口来说，我们1分钟的访问次数不能超过100个。那么我们可以这么做：在一开 始的时候，我们可以设置一个计数器counter，每当一个请求过来的时候，counter就加1，如果counter的值大于100并且该请求与第一个 请求的间隔时间还在1分钟之内，那么说明请求数过多；如果该请求与第一个请求的间隔时间大于1分钟。且counter的值还在限流范围内，那么就重置 counter。

缺点：十分致命的问题，那就是临界问题。

### 2）滑动窗口算法：

滑动窗口，又称rolling window。

时间窗口就是一分钟。然后我们将时间窗口进行划分，比如图中，我们就将滑动窗口 划成了6格，所以每格代表的是10秒钟。每过10秒钟，我们的时间窗口就会往右滑动一格。每一个格子都有自己独立的计数器counter，比如当一个请求 在0:35秒的时候到达，那么0:30~0:39对应的counter就会加1。

计数器算法其实就是滑动窗口算法。只是它没有对时间窗口做进一步地划分，所以只有1格。

由此可见，当滑动窗口的格子划分的越多，那么滑动窗口的滚动就越平滑，限流的统计就会越精确。

### 3）令牌桶算法：

1）、所有的请求在处理之前都需要拿到一个可用的令牌才会被处理；
2）、根据限流大小，设置按照一定的速率往桶里添加令牌；
3）、桶设置最大的放置令牌限制，当桶满时、新添加的令牌就被丢弃或者拒绝；
4）、请求达到后首先要获取令牌桶中的令牌，拿着令牌才可以进行其他的业务逻辑，处理完业务逻辑之后，将令牌直接删除；
5）、令牌桶有最低限额，当桶中的令牌达到最低限额的时候，请求处理完之后将不会删除令牌，以此保证足够的限流；

### 4）漏桶算法：

漏桶算法其实很简单，可以粗略的认为就是注水漏水过程，往桶中以一定速率流出水，以任意速率流入水，当水超过桶流量则丢弃，因为桶容量是不变的，保证了整体的速率。





## Apache Sentinel:

Sentinel 意为哨兵，这个命名形象的诠释了 Sentinel 在分布式系统中的工作角色和重要性，主要功能就是熔断、限流、降级。



### sentinel-adapter:

Sentinel 适配器，目前对主流框架进行了适配，适配器官方文档，目前已适配的模块如下：

sentinel-apache-dubbo-adapter
对 Apache Dubbo （Apache Dubbo 2.7.x 及以上版本）版本进行适配，
sentinel-dubbo-adapter
对 Alibaba Dubbo（Dubbo 2.6.x 及以下版本） 版本进行适配。
sentinel-grpc-adapter
对 GRPC 进行适配。
sentinel-reactor-adapter
对reactor进行适配
sentinel-spring-webflux-adapter
对响应式编程框架 webflux 进行适配。
sentinel-web-servlet
对 servlet 进行适配，例如 Spring MVC。
sentinel-zuul-adapter
对 zuul 网关进行适配。

